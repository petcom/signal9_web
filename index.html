<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Signal 9 Ensemble</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;500&display=swap" rel="stylesheet">
    <style>
        body {
            margin: 0;
            font-family: 'Roboto', sans-serif;
            background-color: #111;
            color: #f0f0f0;
            line-height: 1.6;
        }

        header, section {
            padding: 2rem;
            max-width: 1000px;
            margin: auto;
        }

        header {
            text-align: center;
        }

        h1 {
            font-weight: 500;
            font-size: 2.5rem;
        }

        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin-top: 2rem;
        }

        .media-item {
            background: #222;
            padding: 1rem;
            border-radius: 8px;
        }

        iframe, audio {
            width: 100%;
            border: none;
        }

        #calendar {
            margin-top: 2rem;
        }

        .event-card {
            display: flex;
            gap: 1rem;
            align-items: flex-start;
            border-left: 4px solid #888;
            padding: 1rem;
            margin-bottom: 1rem;
            background-color: #1b1b1b;
            border-radius: 4px;
        }

        .event-card img {
            max-height: 200px;
            width: auto;
            border-radius: 4px;
            flex-shrink: 0;
        }

        .event-card-content {
            flex: 1;
        }

        .event-card h3 {
            margin: 0 0 0.5rem 0;
            font-size: 1.25rem;
        }

        .event-card p {
            margin: 0.25rem 0;
        }

        #contact {
            margin-top: 3rem;
            padding: 2rem;
            background-color: #1a1a1a;
            border-top: 1px solid #333;
            max-width: 800px;
        }

        #contact h2 {
            font-size: 1.8rem;
            margin-bottom: 1.5rem;
        }

        #contact-form .form-row {
            display: flex;
            flex-direction: column;
            margin-bottom: 1rem;
        }

        #contact-form textarea,
        #contact-form input {
            width: 100%;
            padding: 0.6rem;
            background-color: #2a2a2a;
            color: #fff;
            border: 1px solid #555;
            border-radius: 4px;
            font-size: 1rem;
        }

        #contact-form button {
            padding: 0.75rem 1.5rem;
            background-color: #444;
            border: none;
            color: white;
            border-radius: 4px;
            cursor: pointer;
        }

        #form-status {
            margin-top: 1rem;
            font-size: 0.95rem;
        }

        #form-status.error {
            color: #f88;
        }

        #form-status.success {
            color: #8f8;
        }

        .g-recaptcha {
            margin-top: 1rem;
            margin-bottom: 1rem;
        }

        .soundcloud-card {
            background-color: #1e1e1e;
            border: 1px solid #333;
            border-radius: 10px;
            padding: 1rem;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.4);
        }

        .soundcloud-meta {
            margin-top: 0.75rem;
        }

        .soundcloud-meta h3 {
            margin: 0 0 0.25rem;
            font-size: 1.1rem;
            color: #fff;
        }

        .soundcloud-meta p {
            margin: 0;
            font-size: 0.9rem;
            color: #aaa;
        }

        .soundcloud-meta a {
            color: #88f;
            text-decoration: none;
        }

        .soundcloud-meta a:hover {
            text-decoration: underline;
        }
    </style>
</head>
<body>
    <header>
        <h1>Signal 9</h1>
        <p>Modern Music Ensemble | Sound Art | Improvisation</p>
        <button onclick="document.getElementById('contact').scrollIntoView({ behavior: 'smooth' })">
            Contact Us
        </button>
    </header>

    <section>
        <h2>Media</h2>
        <div class="grid">
           <div class="media-item soundcloud-card">
            <iframe 
                width="100%" 
                height="300" 
                scrolling="no" 
                frameborder="no" 
                allow="autoplay" 
                style="border-radius: 8px;" 
                src="https://w.soundcloud.com/player/?url=https%3A//api.soundcloud.com/tracks/2112603057&color=%23111111&auto_play=false&hide_related=false&show_comments=false&show_user=true&show_reposts=false&show_teaser=false&visual=true">
            </iframe>
            <div class="soundcloud-meta">
                <h3>Clair De Lune</h3>
                <p>by <a href="https://soundcloud.com/signal-9-band" target="_blank">Signal-9 Band</a></p>
            </div>
        </div>
            <div class="media-item">
                <iframe src="https://www.youtube.com/embed/dQw4w9WgXcQ" allowfullscreen></iframe>
                <p>Live at Sonic Fields 2024</p>
            </div>
        </div>
    </section>

    <section id="calendar">
        <h2>Upcoming Events</h2>
        <div id="upcoming-events">
            <p>Loading upcoming events...</p>
        </div>
    </section>

    <section id="previous-calendar">
        <h2>Previous Events</h2>
        <div id="previous-events">
            <p>Loading previous events...</p>
        </div>
    </section>

    <section id="contact">
        <h2>Contact Us</h2>
        <form id="contact-form">
            <div class="form-row">
                <label for="name">Name</label><br />
                <input type="text" id="name" name="name" required />
            </div>
            <div class="form-row">
                <label for="email">Email</label><br />
                <input type="email" id="email" name="email" required />
            </div>
            <div class="form-row">
                <label for="message">Message</label><br />
                <textarea id="message" name="message" rows="5" required></textarea>
            </div>
            <div class="g-recaptcha" data-sitekey="6Lf7RVsrAAAAANPJrIUWNt1BIFc6K6qjJX6jQ7gX"></div>
            <button type="submit">Send</button>
            <p id="form-status"></p>
        </form>
    </section>

    <script src="https://www.google.com/recaptcha/api.js" async defer></script>
<script>
  const EVENTS_PROXY_URL = 'http://signal-9.com/proxy-api/events/query';
  const DEFAULT_TAGS = 'signal-9,sonar,public';

  async function loadEvents() {
    loadUpcomingEvents();
    loadPreviousEvents();
  }

  async function loadUpcomingEvents() {
    const container = document.getElementById('upcoming-events');
    container.innerHTML = '<p>Loading upcoming events...</p>';

    try {
      const tags = DEFAULT_TAGS.split(',').map(t => t.trim()).filter(Boolean);

      const res = await fetch(EVENTS_PROXY_URL, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          tags: tags,
          tag_logic: 'or',
          startDate: new Date().toISOString().split('T')[0] // today
        })
      });

      if (!res.ok) throw new Error(`Fetch failed: ${res.status}`);
      const events = await res.json();
      container.innerHTML = '';

      if (!events.length) {
        container.innerHTML = '<p>No upcoming events found.</p>';
        return;
      }

      events.forEach(event => {
        container.appendChild(buildEventCard(event));
      });
    } catch (err) {
      console.error('[Page] Failed to load upcoming events:', err);
      container.innerHTML = '<p>Unable to load upcoming events.</p>';
    }
  }

  async function loadPreviousEvents() {
    const container = document.getElementById('previous-events');
    container.innerHTML = '<p>Loading previous events...</p>';

    try {
      const tags = DEFAULT_TAGS.split(',').map(t => t.trim()).filter(Boolean);

      // Get dates for the last 2 weeks
      const today = new Date();

      const yesterday = new Date(today);
      yesterday.setDate(today.getDate() - 1);

      const pastDate = new Date();
      pastDate.setDate(today.getDate() - 30);

      const res = await fetch(EVENTS_PROXY_URL, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          tags: tags,
          tag_logic: 'or',
          startDate: pastDate.toISOString().split('T')[0],
          endDate: yesterday.toISOString().split('T')[0]
        })
      });

      if (!res.ok) throw new Error(`Fetch failed: ${res.status}`);
      const events = await res.json();
      container.innerHTML = '';

      if (!events.length) {
        container.innerHTML = '<p>No previous events found.</p>';
        return;
      }

      events.forEach(event => {
        container.appendChild(buildEventCard(event));
      });
    } catch (err) {
      console.error('[Page] Failed to load previous events:', err);
      container.innerHTML = '<p>Unable to load previous events.</p>';
    }
  }

  function buildEventCard(event) {
    const card = document.createElement('div');
    card.className = 'event-card';

    const thumbnail = event.thumb_image_url
      ? `<img src="${event.thumb_image_url}" alt="${event.title} thumbnail" />`
      : '';

    card.innerHTML = `
      ${thumbnail}
      <div class="event-card-content">
        <h3>${event.title}</h3>
        <p><strong>Date:</strong> ${new Date(event.event_date).toLocaleDateString()}</p>
        <p>${event.description}</p>
      </div>
    `;
    return card;
  }

  loadEvents();
</script>


</body>
</html>
